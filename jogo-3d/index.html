<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Void</title>
    <script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; position: fixed; top: 0; left: 0; }
        
        #menu { 
            position: absolute; width: 100%; height: 100%; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(0, 5, 10, 0.8); z-index: 100; color: #0ff;
        }
        
        .btn { 
            background: #0ff; color: #000; border: none; padding: 15px 30px; 
            font-size: 20px; font-weight: bold; cursor: pointer; border-radius: 5px;
            box-shadow: 0 0 15px #0ff; pointer-events: auto;
        }

        .ui-hud { 
            position: absolute; top: 20px; width: 100%; display: none; 
            justify-content: space-between; padding: 0 20px; box-sizing: border-box; 
            z-index: 50; color: #0ff; font-weight: bold; pointer-events: none;
        }

        #game-over { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); border: 2px solid red; padding: 30px;
            display: none; text-align: center; color: white; z-index: 200; border-radius: 10px;
        }
    </style>
</head>
<body>

    <div id="menu">
        <h1 style="text-shadow: 0 0 10px #0ff;">NEON VOID</h1>
        <p>Setas: Mover | Espaço: Pular</p>
        <button class="btn" id="start-btn">JOGAR AGORA</button>
    </div>

    <div class="ui-hud" id="hud">
        <div style="background:red; color:white; padding:5px 10px; border-radius:3px; pointer-events:auto; cursor:pointer;" onclick="location.href='../index.html'">VOLTAR</div>
        <div style="font-size: 20px;">SCORE: <span id="score-val">0</span></div>
    </div>

    <div id="game-over">
        <h2 id="msg" style="color:red;">FIM DE JOGO</h2>
        <p>Pontos: <span id="final-val">0</span></p>
        <button class="btn" style="background:red;" onclick="location.reload()">REINICIAR</button>
    </div>

    <script>
        const startBtn = document.getElementById('start-btn');
        const menu = document.getElementById('menu');
        const hud = document.getElementById('hud');
        
        let scene, camera, renderer, player, grid;
        let score = 0, speed = 0.2, isGameOver = false;
        let velY = 0, jumping = false, falling = false;
        const walls = [], keys = {};

        startBtn.addEventListener('click', () => {
            menu.style.display = 'none';
            hud.style.display = 'flex';
            initGame();
        });

        function initGame() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x00050a);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: false });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0xffffff, 1));

            // Player
            player = new THREE.Mesh(
                new THREE.BoxGeometry(0.5, 0.5, 0.5),
                new THREE.MeshBasicMaterial({ color: 0x00ffff, wireframe: true })
            );
            scene.add(player);

            // Chão (Ponte de 6 unidades)
            grid = new THREE.GridHelper(6, 12, 0xff00ff, 0x444444);
            grid.position.y = -0.25;
            scene.add(grid);

            camera.position.set(0, 3, 7);
            camera.lookAt(0, 1, 0);

            // Inicia spawn de obstáculos
            setInterval(spawnWall, 2000);

            // Input listener
            window.addEventListener('keydown', e => { 
                keys[e.key] = true;
                if((e.code === 'Space' || e.key === 'ArrowUp') && !jumping && !falling) {
                    velY = 0.22; jumping = true;
                }
            });
            window.addEventListener('keyup', e => keys[e.key] = false);

            loop();
        }

        function spawnWall() {
            if(isGameOver) return;
            const wall = new THREE.Group();
            const hole = Math.floor(Math.random() * 11); // Escolhe onde fica o buraco de 2 blocos

            for(let r=0; r<4; r++) { // 4 de altura
                for(let c=0; c<12; c++) { // 12 colunas cobrem a pista
                    if((c === hole || c === hole + 1) && r === 0) continue; // Buraco no chão
                    
                    const block = new THREE.Mesh(
                        new THREE.BoxGeometry(0.48, 0.48, 0.48),
                        new THREE.MeshBasicMaterial({ color: 0xff0000 })
                    );
                    block.position.set((c * 0.5) - 2.75, r * 0.5, 0);
                    wall.add(block);
                }
            }
            wall.position.z = -40;
            scene.add(wall);
            walls.push(wall);
        }

        function loop() {
            if(isGameOver) return;
            requestAnimationFrame(loop);

            // Movimento
            if(keys['ArrowLeft']) player.position.x -= 0.12;
            if(keys['ArrowRight']) player.position.x += 0.12;

            // Vácuo (limite lateral 3.0)
            if(Math.abs(player.position.x) > 3.0 && !jumping) falling = true;

            // Física
            if(jumping || falling) {
                player.position.y += velY;
                velY -= 0.015;
                if(!falling && player.position.y <= 0) {
                    player.position.y = 0; jumping = false; velY = 0;
                }
            }

            if(player.position.y < -5) endGame("VOCÊ CAIU!");

            // Grid e Paredes
            grid.position.z += speed;
            if(grid.position.z > 1) grid.position.z = 0;

            for(let i=walls.length-1; i>=0; i--) {
                walls[i].position.z += speed;
                
                // Colisão
                if(Math.abs(walls[i].position.z - player.position.z) < 0.3) {
                    walls[i].children.forEach(b => {
                        const bX = walls[i].position.x + b.position.x;
                        const bY = walls[i].position.y + b.position.y;
                        if(Math.abs(player.position.x - bX) < 0.35 && Math.abs(player.position.y - bY) < 0.35) {
                            endGame("COLISÃO!");
                        }
                    });
                }

                if(walls[i].position.z > 10) {
                    scene.remove(walls[i]);
                    walls.splice(i, 1);
                    score += 100;
                    document.getElementById('score-val').innerText = score;
                }
            }
            renderer.render(scene, camera);
        }

        function endGame(txt) {
            isGameOver = true;
            document.getElementById('game-over').style.display = 'block';
            document.getElementById('msg').innerText = txt;
            document.getElementById('final-val').innerText = score;
        }
    </script>
</body>
</html>
